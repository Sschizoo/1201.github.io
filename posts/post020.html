<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevOpså®è·µï¼šä»æ‰‹åŠ¨éƒ¨ç½²åˆ°å…¨è‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿ - æˆ‘çš„åšå®¢</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header>
        <h1 class="slogan">è®°å½•æ€è€ƒï¼Œåˆ†äº«ç”Ÿæ´»</h1>
    </header>
    
    <main>
        <div class="container">
            <a href="../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
            
            <article class="article-page">
                <div class="article-header">
                    <h1>DevOpså®è·µï¼šä»æ‰‹åŠ¨éƒ¨ç½²åˆ°å…¨è‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿</h1>
                    <p class="article-date">2025å¹´07æœˆ03æ—¥</p>
                </div>
                
                <div class="article-content">
                    <p><strong>Date: June 7, 2024</strong></p>
<p>ä»Šå¤©æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬å›¢é˜Ÿåœ¨DevOpså®è·µæ–¹é¢çš„æ¼”è¿›å†ç¨‹ã€‚ä»æœ€åˆçš„æ‰‹åŠ¨éƒ¨ç½²åˆ°ç°åœ¨çš„å…¨è‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿ï¼Œè¿™ä¸ªè¿‡ç¨‹å……æ»¡äº†æŒ‘æˆ˜å’Œæ”¶è·ã€‚</p>
<h2>ä¼ ç»Ÿéƒ¨ç½²æ¨¡å¼çš„ç—›ç‚¹</h2>
<h3>æ‰‹åŠ¨éƒ¨ç½²æ—¶ä»£çš„å›°æ‰°</h3>
<p>è¿˜è®°å¾—å‡ å¹´å‰ï¼Œæˆ‘ä»¬çš„éƒ¨ç½²æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-bash"># ä¼ ç»Ÿçš„æ‰‹åŠ¨éƒ¨ç½²æµç¨‹
#!/bin/bash

echo &quot;å¼€å§‹éƒ¨ç½²...&quot;

# 1. è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
ssh user@production-server

# 2. å¤‡ä»½å½“å‰ç‰ˆæœ¬
cp -r /var/www/app /var/www/app_backup_$(date +%Y%m%d_%H%M%S)

# 3. æ‹‰å–æœ€æ–°ä»£ç 
cd /var/www/app
git pull origin main

# 4. å®‰è£…ä¾èµ–
npm install --production

# 5. æ„å»ºé¡¹ç›®
npm run build

# 6. é‡å¯æœåŠ¡
pm2 restart app

# 7. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

echo &quot;éƒ¨ç½²å®Œæˆï¼&quot;
</code></pre>
<p>è¿™ç§æ–¹å¼å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼š</p>
<pre><code class="language-javascript">const manualDeploymentProblems = {
  äººä¸ºé”™è¯¯: [
    &quot;å¿˜è®°æ‰§è¡ŒæŸä¸ªæ­¥éª¤&quot;,
    &quot;åœ¨é”™è¯¯çš„ç¯å¢ƒæ‰§è¡Œå‘½ä»¤&quot;,
    &quot;ç‰ˆæœ¬å›æ»šå›°éš¾&quot;,
    &quot;é…ç½®æ–‡ä»¶ä¿®æ”¹é”™è¯¯&quot;
  ],

  æ•ˆç‡é—®é¢˜: [
    &quot;éƒ¨ç½²æ—¶é—´é•¿ï¼Œéœ€è¦äººå·¥ç›‘æ§&quot;,
    &quot;å¤šç¯å¢ƒéƒ¨ç½²éœ€è¦é‡å¤æ“ä½œ&quot;,
    &quot;å›æ»šæµç¨‹å¤æ‚&quot;,
    &quot;æ— æ³•å¹¶è¡Œéƒ¨ç½²å¤šä¸ªæœåŠ¡&quot;
  ],

  è´¨é‡é£é™©: [
    &quot;ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•&quot;,
    &quot;ç”Ÿäº§ç¯å¢ƒç›´æ¥æµ‹è¯•&quot;,
    &quot;æ²¡æœ‰éƒ¨ç½²å®¡æ ¸æµç¨‹&quot;,
    &quot;ç›‘æ§å’Œå‘Šè­¦ä¸åŠæ—¶&quot;
  ],

  åä½œå›°éš¾: [
    &quot;éƒ¨ç½²æƒé™ç®¡ç†æ··ä¹±&quot;,
    &quot;ç¼ºå°‘éƒ¨ç½²è®°å½•&quot;,
    &quot;å›¢é˜Ÿæˆå‘˜éƒ¨ç½²æµç¨‹ä¸ä¸€è‡´&quot;,
    &quot;çŸ¥è¯†ä¼ é€’å›°éš¾&quot;
  ]
};
</code></pre>
<h2>CI/CDæµæ°´çº¿è®¾è®¡</h2>
<h3>æ•´ä½“æ¶æ„</h3>
<p>æˆ‘ä»¬è®¾è®¡çš„CI/CDæµæ°´çº¿æ¶æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-yaml"># .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

env:
  NODE_VERSION: '18'
  DOCKER_REGISTRY: 'your-registry.com'
  APP_NAME: 'web-app'

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run linting
      run: npm run lint

    - name: Run type checking
      run: npm run type-check

    - name: Run unit tests
      run: npm run test:unit

    - name: Run integration tests
      run: npm run test:integration

    - name: Generate test coverage
      run: npm run test:coverage

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        token: ${{ secrets.CODECOV_TOKEN }}

  # å®‰å…¨æ‰«æ
  security-scan:
    runs-on: ubuntu-latest
    needs: lint-and-test
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Run npm audit
      run: npm audit --audit-level high

    - name: Run Snyk security scan
      uses: snyk/actions/node@master
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

    - name: Run SAST scan
      uses: github/codeql-action/init@v2
      with:
        languages: javascript

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2

  # æ„å»ºå’Œæ¨é€Dockeré•œåƒ
  build-and-push:
    runs-on: ubuntu-latest
    needs: [lint-and-test, security-scan]
    if: github.ref == 'refs/heads/main'
    outputs:
      image-tag: ${{ steps.meta.outputs.tags }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2

    - name: Login to Container Registry
      uses: docker/login-action@v2
      with:
        registry: ${{ env.DOCKER_REGISTRY }}
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    - name: Extract metadata
      id: meta
      uses: docker/metadata-action@v4
      with:
        images: ${{ env.DOCKER_REGISTRY }}/${{ env.APP_NAME }}
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=sha,prefix={{branch}}-
          type=raw,value=latest,enable={{is_default_branch}}

    - name: Build and push Docker image
      uses: docker/build-push-action@v4
      with:
        context: .
        platforms: linux/amd64,linux/arm64
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        labels: ${{ steps.meta.outputs.labels }}
        cache-from: type=gha
        cache-to: type=gha,mode=max

  # éƒ¨ç½²åˆ°stagingç¯å¢ƒ
  deploy-staging:
    runs-on: ubuntu-latest
    needs: build-and-push
    environment: staging
    steps:
    - name: Deploy to staging
      uses: ./.github/actions/deploy
      with:
        environment: staging
        image-tag: ${{ needs.build-and-push.outputs.image-tag }}
        kubeconfig: ${{ secrets.STAGING_KUBECONFIG }}

    - name: Run smoke tests
      run: |
        npm run test:smoke -- --baseUrl=https://staging.example.com

  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
  deploy-production:
    runs-on: ubuntu-latest
    needs: [build-and-push, deploy-staging]
    environment: production
    if: github.ref == 'refs/heads/main'
    steps:
    - name: Deploy to production
      uses: ./.github/actions/deploy
      with:
        environment: production
        image-tag: ${{ needs.build-and-push.outputs.image-tag }}
        kubeconfig: ${{ secrets.PRODUCTION_KUBECONFIG }}

    - name: Run production health checks
      run: |
        npm run test:health -- --baseUrl=https://app.example.com

    - name: Notify deployment success
      uses: 8398a7/action-slack@v3
      with:
        status: success
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
</code></pre>
<h3>è‡ªå®šä¹‰éƒ¨ç½²Action</h3>
<pre><code class="language-yaml"># .github/actions/deploy/action.yml
name: 'Deploy Application'
description: 'Deploy application to Kubernetes'
inputs:
  environment:
    description: 'Target environment'
    required: true
  image-tag:
    description: 'Docker image tag'
    required: true
  kubeconfig:
    description: 'Kubernetes config'
    required: true

runs:
  using: 'composite'
  steps:
  - name: Setup kubectl
    uses: azure/setup-kubectl@v3
    with:
      version: 'v1.27.0'

  - name: Setup Helm
    uses: azure/setup-helm@v3
    with:
      version: '3.12.0'

  - name: Configure kubectl
    shell: bash
    run: |
      echo &quot;${{ inputs.kubeconfig }}&quot; | base64 -d &gt; kubeconfig
      export KUBECONFIG=kubeconfig

  - name: Deploy with Helm
    shell: bash
    run: |
      helm upgrade --install ${{ github.event.repository.name }} ./helm \
        --namespace ${{ inputs.environment }} \
        --create-namespace \
        --set image.tag=${{ inputs.image-tag }} \
        --set environment=${{ inputs.environment }} \
        --wait --timeout=600s

  - name: Verify deployment
    shell: bash
    run: |
      kubectl wait --for=condition=available --timeout=300s \
        deployment/${{ github.event.repository.name }} \
        -n ${{ inputs.environment }}
</code></pre>
<h2>DockeråŒ–æœ€ä½³å®è·µ</h2>
<h3>å¤šé˜¶æ®µæ„å»ºDockerfile</h3>
<pre><code class="language-dockerfile"># å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
FROM node:18-alpine AS base
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production &amp;&amp; npm cache clean --force

# å¼€å‘ä¾èµ–å®‰è£…
FROM base AS dev-deps
RUN npm ci

# æ„å»ºé˜¶æ®µ
FROM dev-deps AS build
COPY . .
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:18-alpine AS production

# å®‰å…¨å¢å¼º
RUN addgroup -g 1001 -S nodejs &amp;&amp; \
    adduser -S nextjs -u 1001

# å®‰è£…å¿…è¦çš„ç³»ç»ŸåŒ…
RUN apk add --no-cache \
    dumb-init \
    curl

WORKDIR /app

# å¤åˆ¶ç”Ÿäº§ä¾èµ–
COPY --from=base /app/node_modules ./node_modules
COPY --from=build /app/dist ./dist
COPY --from=build /app/public ./public
COPY package.json ./

# è®¾ç½®æ­£ç¡®çš„æƒé™
RUN chown -R nextjs:nodejs /app
USER nextjs

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

EXPOSE 3000

# ä½¿ç”¨dumb-initå¤„ç†ä¿¡å·
ENTRYPOINT [&quot;dumb-init&quot;, &quot;--&quot;]
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre>
<h3>Docker Composeç”¨äºæœ¬åœ°å¼€å‘</h3>
<pre><code class="language-yaml"># docker-compose.yml
version: '3.8'

services:
  app:
    build:
      context: .
      target: dev-deps
    volumes:
      - .:/app
      - /app/node_modules
    ports:
      - &quot;3000:3000&quot;
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgresql://user:pass@db:5432/appdb
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    command: npm run dev

  db:
    image: postgres:14-alpine
    environment:
      POSTGRES_DB: appdb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - &quot;5432:5432&quot;

  redis:
    image: redis:7-alpine
    ports:
      - &quot;6379:6379&quot;
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - &quot;80:80&quot;
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - app

volumes:
  postgres_data:
  redis_data:
</code></pre>
<h2>åŸºç¡€è®¾æ–½å³ä»£ç (IaC)</h2>
<h3>Terraformé…ç½®</h3>
<pre><code class="language-hcl"># infrastructure/main.tf
terraform {
  required_version = &quot;&gt;= 1.0&quot;
  required_providers {
    aws = {
      source  = &quot;hashicorp/aws&quot;
      version = &quot;~&gt; 5.0&quot;
    }
    kubernetes = {
      source  = &quot;hashicorp/kubernetes&quot;
      version = &quot;~&gt; 2.20&quot;
    }
  }

  backend &quot;s3&quot; {
    bucket = &quot;your-terraform-state&quot;
    key    = &quot;app/terraform.tfstate&quot;
    region = &quot;us-west-2&quot;
  }
}

provider &quot;aws&quot; {
  region = var.aws_region
}

# EKS Cluster
module &quot;eks&quot; {
  source = &quot;terraform-aws-modules/eks/aws&quot;

  cluster_name    = var.cluster_name
  cluster_version = &quot;1.27&quot;

  vpc_id     = module.vpc.vpc_id
  subnet_ids = module.vpc.private_subnets

  # Node groups
  eks_managed_node_groups = {
    general = {
      desired_size = 2
      max_size     = 10
      min_size     = 1

      instance_types = [&quot;t3.medium&quot;]
      capacity_type  = &quot;ON_DEMAND&quot;

      k8s_labels = {
        Environment = var.environment
        NodeGroup   = &quot;general&quot;
      }
    }
  }

  # Cluster access
  cluster_endpoint_private_access = true
  cluster_endpoint_public_access  = true

  cluster_addons = {
    coredns = {
      most_recent = true
    }
    kube-proxy = {
      most_recent = true
    }
    vpc-cni = {
      most_recent = true
    }
    aws-ebs-csi-driver = {
      most_recent = true
    }
  }
}

# VPC
module &quot;vpc&quot; {
  source = &quot;terraform-aws-modules/vpc/aws&quot;

  name = &quot;${var.cluster_name}-vpc&quot;
  cidr = &quot;10.0.0.0/16&quot;

  azs             = data.aws_availability_zones.available.names
  private_subnets = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]
  public_subnets  = [&quot;10.0.101.0/24&quot;, &quot;10.0.102.0/24&quot;, &quot;10.0.103.0/24&quot;]

  enable_nat_gateway = true
  enable_vpn_gateway = false

  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    &quot;kubernetes.io/cluster/${var.cluster_name}&quot; = &quot;shared&quot;
  }

  public_subnet_tags = {
    &quot;kubernetes.io/cluster/${var.cluster_name}&quot; = &quot;shared&quot;
    &quot;kubernetes.io/role/elb&quot;                    = &quot;1&quot;
  }

  private_subnet_tags = {
    &quot;kubernetes.io/cluster/${var.cluster_name}&quot; = &quot;shared&quot;
    &quot;kubernetes.io/role/internal-elb&quot;           = &quot;1&quot;
  }
}

# RDS Database
resource &quot;aws_db_instance&quot; &quot;main&quot; {
  identifier = &quot;${var.cluster_name}-db&quot;

  engine         = &quot;postgres&quot;
  engine_version = &quot;14.9&quot;
  instance_class = &quot;db.t3.micro&quot;

  allocated_storage     = 20
  max_allocated_storage = 100
  storage_type          = &quot;gp2&quot;
  storage_encrypted     = true

  db_name  = var.db_name
  username = var.db_username
  password = var.db_password

  vpc_security_group_ids = [aws_security_group.rds.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name

  backup_retention_period = 7
  backup_window          = &quot;03:00-04:00&quot;
  maintenance_window     = &quot;Sun:04:00-Sun:05:00&quot;

  skip_final_snapshot = true
  deletion_protection = false

  tags = {
    Name = &quot;${var.cluster_name}-db&quot;
  }
}
</code></pre>
<h3>Helm Charts</h3>
<pre><code class="language-yaml"># helm/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include &quot;app.fullname&quot; . }}
  labels:
    {{- include &quot;app.labels&quot; . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      {{- include &quot;app.selectorLabels&quot; . | nindent 6 }}
  template:
    metadata:
      annotations:
        checksum/config: {{ include (print $.Template.BasePath &quot;/configmap.yaml&quot;) . | sha256sum }}
        checksum/secret: {{ include (print $.Template.BasePath &quot;/secret.yaml&quot;) . | sha256sum }}
        {{- with .Values.podAnnotations }}
        {{- toYaml . | nindent 8 }}
        {{- end }}
      labels:
        {{- include &quot;app.selectorLabels&quot; . | nindent 8 }}
    spec:
      {{- with .Values.imagePullSecrets }}
      imagePullSecrets:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      serviceAccountName: {{ include &quot;app.serviceAccountName&quot; . }}
      securityContext:
        {{- toYaml .Values.podSecurityContext | nindent 8 }}
      containers:
        - name: {{ .Chart.Name }}
          securityContext:
            {{- toYaml .Values.securityContext | nindent 12 }}
          image: &quot;{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}&quot;
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - name: http
              containerPort: {{ .Values.service.port }}
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /health
              port: http
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /ready
              port: http
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 2
          env:
            - name: NODE_ENV
              value: {{ .Values.environment }}
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: {{ include &quot;app.fullname&quot; . }}-secret
                  key: database-url
          envFrom:
            - configMapRef:
                name: {{ include &quot;app.fullname&quot; . }}-config
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
          volumeMounts:
            - name: tmp
              mountPath: /tmp
            - name: var-cache
              mountPath: /var/cache
      volumes:
        - name: tmp
          emptyDir: {}
        - name: var-cache
          emptyDir: {}
      {{- with .Values.nodeSelector }}
      nodeSelector:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.affinity }}
      affinity:
        {{- toYaml . | nindent 8 }}
      {{- end }}
      {{- with .Values.tolerations }}
      tolerations:
        {{- toYaml . | nindent 8 }}
      {{- end }}
</code></pre>
<h2>ç›‘æ§å’Œå‘Šè­¦ä½“ç³»</h2>

ä¸ºä¿è¯ç³»ç»Ÿæ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒï¼Œéœ€éƒ¨ç½²è¿è¡ŒçŠ¶æ€ç›‘æµ‹ä¸è‡ªåŠ¨ä¼˜åŒ–æœºåˆ¶ã€‚ç³»ç»Ÿåº”å¯¹å†…å­˜ã€CPUã€ç¼“å­˜ä½¿ç”¨ç­‰å…³é”®æŒ‡æ ‡è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œå¹¶å¯åŸºäºç­–ç•¥è‡ªåŠ¨è°ƒæ•´æ¨¡å‹åŠ è½½ã€æ•°æ®ç¼“å­˜ä¸æ¸²æŸ“æµç¨‹ã€‚åº”æä¾›äº¤äº’å¼ä¼˜åŒ–å·¥å…·ï¼Œæ”¯æŒç”¨æˆ·åœ¨è¿è¡Œåœºæ™¯ä¸­å¯¹æ¨¡å‹ç»“æ„è¿›è¡Œè°ƒæ•´ã€æµ‹è¯•ä¸ç‰ˆæœ¬ç®¡ç†ï¼Œä¾¿äºå¿«é€Ÿå“åº”éœ€æ±‚å˜åŒ–ä¸ç³»ç»Ÿæ‰©å±•ã€‚

èƒ½æºèµ„äº§æ¨¡å‹å…·å¤‡ç»“æ„å¤æ‚ã€æ•°æ®é‡å¤§ã€åŠ¨æ€æ€§å¼ºç­‰ç‰¹å¾ï¼Œå¯¹æ¸²æŸ“ç³»ç»Ÿæå‡ºäº†å®æ—¶ã€é«˜ç²¾åº¦ä¸å¤šç»ˆç«¯é€‚é…çš„è¦æ±‚ã€‚æœ¬æ¨¡å—èšç„¦äºæ¨¡å‹åŠ è½½æ•ˆç‡å’Œæ¸²æŸ“æ€§èƒ½çš„å…¨é¢æå‡ï¼Œæ„å»ºåˆ†å±‚åˆ†å—åŠ è½½ä½“ç³»ä¸å¯è§†æ€§é©±åŠ¨çš„æ™ºèƒ½æ¸²æŸ“æœºåˆ¶ï¼Œå®ç°"æ•°æ®å°‘åŠ è½½ã€å†…å®¹å¿«å‘ˆç°"çš„ç›®æ ‡ã€‚é€šè¿‡åˆ†çº§æ¨¡å‹è¡¨è¾¾ã€å±€éƒ¨æ¸²æŸ“ä¸ç®¡çº¿ä¼˜åŒ–ç­‰æŠ€æœ¯æ‰‹æ®µï¼Œç³»ç»Ÿå°†å¤§å¹…æå‡æ¨¡å‹å“åº”é€Ÿåº¦ã€äº¤äº’æµç•…åº¦ä¸å›¾åƒè´¨é‡è¡¨ç°ï¼Œä¸ºå„ç±»ç»ˆç«¯æä¾›ä¸€è‡´ã€ç¨³å®šçš„æ¸²æŸ“ä½“éªŒï¼Œæ”¯æ’‘ä»å°å¼è®¡ç®—æœºåˆ°ç§»åŠ¨ç«¯ã€ARVRè®¾å¤‡çš„ç»Ÿä¸€è®¿é—®ã€‚

ç³»ç»Ÿéœ€æ£€æµ‹è§„åˆ’æ–¹æ¡ˆä¸­å› çº¿è·¯è°ƒæ•´ã€å¼€å…³é…ç½®ç­‰å› ç´ å¯¼è‡´çš„æ¥çº¿æ¨¡å¼é€€åŒ–ç°è±¡ã€‚é€€åŒ–åˆ¤å®šåº”åŸºäºæ ‡å‡†æ¥çº¿é…ç½®(å¦‚å•æ¯çº¿ã€åŒæ¯çº¿ã€ç¯ç½‘ç»“æ„)ä¸å®é™…è§„åˆ’æ–¹æ¡ˆè¿›è¡Œå¯¹æ¯”åˆ†æï¼Œè¯†åˆ«ç®€åŒ–ã€é™çº§æˆ–æ–­é“¾æƒ…å½¢ã€‚æ£€æµ‹ç»“æœéœ€å®æ—¶ç”Ÿæˆé€€åŒ–é¢„è­¦ä¿¡æ¯ï¼Œæ ‡æ˜é€€åŒ–ç­‰çº§ã€æ³¢åŠèŒƒå›´ä¸å…³é”®è®¾å¤‡ï¼Œæ”¯æŒè”åŠ¨å›¾å±‚é«˜äº®æ˜¾ç¤ºã€‚é¢„è­¦ä¿¡æ¯åº”è¾“å‡ºè‡³è°ƒåº¦æˆ–è¿ç»´ç•Œé¢ï¼Œç”¨äºè¾…åŠ©äººå‘˜å¿«é€Ÿå“åº”ä¸è§„é¿é£é™©ã€‚

<h3>Prometheusç›‘æ§é…ç½®</h3>
<pre><code class="language-yaml"># monitoring/prometheus-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    rule_files:
      - &quot;/etc/prometheus/rules/*.yml&quot;

    alerting:
      alertmanagers:
        - static_configs:
            - targets:
              - alertmanager:9093

    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']

      - job_name: 'app'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            regex: ([^:]+)(?::\d+)?;(\d+)
            replacement: $1:$2
            target_label: __address__

      - job_name: 'kubernetes-nodes'
        kubernetes_sd_configs:
          - role: node
        relabel_configs:
          - action: labelmap
            regex: __meta_kubernetes_node_label_(.+)

      - job_name: 'kubernetes-pods'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
</code></pre>
<h3>å‘Šè­¦è§„åˆ™</h3>
<pre><code class="language-yaml"># monitoring/alert-rules.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: app-alerts
spec:
  groups:
  - name: app.rules
    rules:
    - alert: HighErrorRate
      expr: rate(http_requests_total{status=~&quot;5..&quot;}[5m]) / rate(http_requests_total[5m]) &gt; 0.1
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: &quot;High error rate detected&quot;
        description: &quot;Error rate is {{ $value | humanizePercentage }} for {{ $labels.instance }}&quot;

    - alert: HighResponseTime
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) &gt; 0.5
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: &quot;High response time detected&quot;
        description: &quot;95th percentile response time is {{ $value }}s for {{ $labels.instance }}&quot;

    - alert: PodCrashLooping
      expr: increase(kube_pod_container_status_restarts_total[1h]) &gt; 5
      for: 0m
      labels:
        severity: critical
      annotations:
        summary: &quot;Pod is crash looping&quot;
        description: &quot;Pod {{ $labels.pod }} has restarted {{ $value }} times in the last hour&quot;

    - alert: DeploymentReplicasMismatch
      expr: kube_deployment_spec_replicas != kube_deployment_status_available_replicas
      for: 15m
      labels:
        severity: warning
      annotations:
        summary: &quot;Deployment replicas mismatch&quot;
        description: &quot;Deployment {{ $labels.deployment }} has {{ $value }} available replicas, expected {{ $labels.spec_replicas }}&quot;
</code></pre>
<h2>è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ</h2>
<h3>æµ‹è¯•æµæ°´çº¿</h3>
<pre><code class="language-javascript">// tests/integration/deployment.test.js
const request = require('supertest');
const { expect } = require('chai');

describe('Deployment Integration Tests', () =&gt; {
  const baseUrl = process.env.BASE_URL || 'http://localhost:3000';

  describe('Health Checks', () =&gt; {
    it('should respond to health check', async () =&gt; {
      const response = await request(baseUrl)
        .get('/health')
        .expect(200);

      expect(response.body).to.have.property('status', 'ok');
      expect(response.body).to.have.property('timestamp');
      expect(response.body).to.have.property('version');
    });

    it('should respond to readiness check', async () =&gt; {
      const response = await request(baseUrl)
        .get('/ready')
        .expect(200);

      expect(response.body).to.have.property('status', 'ready');
      expect(response.body).to.have.property('database', 'connected');
      expect(response.body).to.have.property('redis', 'connected');
    });
  });

  describe('API Endpoints', () =&gt; {
    it('should handle API requests', async () =&gt; {
      const response = await request(baseUrl)
        .get('/api/v1/users')
        .expect(200);

      expect(response.body).to.be.an('array');
    });

    it('should handle authentication', async () =&gt; {
      await request(baseUrl)
        .get('/api/v1/protected')
        .expect(401);
    });
  });

  describe('Performance Tests', () =&gt; {
    it('should respond within acceptable time', async () =&gt; {
      const start = Date.now();

      await request(baseUrl)
        .get('/api/v1/users')
        .expect(200);

      const duration = Date.now() - start;
      expect(duration).to.be.below(500); // 500ms
    });
  });
});
</code></pre>
<h3>E2Eæµ‹è¯•</h3>
<pre><code class="language-javascript">// tests/e2e/user-journey.spec.js
const { test, expect } = require('@playwright/test');

test.describe('User Journey', () =&gt; {
  test('user can complete full signup flow', async ({ page }) =&gt; {
    // Navigate to signup page
    await page.goto('/signup');

    // Fill form
    await page.fill('[data-testid=email]', 'test@example.com');
    await page.fill('[data-testid=password]', 'SecurePass123!');
    await page.fill('[data-testid=confirm-password]', 'SecurePass123!');

    // Submit form
    await page.click('[data-testid=submit]');

    // Wait for success message
    await expect(page.locator('[data-testid=success-message]')).toBeVisible();

    // Verify redirect to dashboard
    await expect(page).toHaveURL('/dashboard');

    // Verify user is logged in
    await expect(page.locator('[data-testid=user-menu]')).toBeVisible();
  });

  test('user can navigate between pages', async ({ page }) =&gt; {
    await page.goto('/');

    // Check navigation links
    await page.click('a[href=&quot;/about&quot;]');
    await expect(page).toHaveURL('/about');

    await page.click('a[href=&quot;/contact&quot;]');
    await expect(page).toHaveURL('/contact');

    // Check responsive navigation
    await page.setViewportSize({ width: 375, height: 667 });
    await page.click('[data-testid=mobile-menu-toggle]');
    await expect(page.locator('[data-testid=mobile-menu]')).toBeVisible();
  });
});
</code></pre>
<h2>å›æ»šå’Œç¾éš¾æ¢å¤</h2>
<h3>è‡ªåŠ¨å›æ»šæœºåˆ¶</h3>
<pre><code class="language-bash">#!/bin/bash
# scripts/rollback.sh

set -e

NAMESPACE=${1:-production}
RELEASE_NAME=${2:-app}
ROLLBACK_VERSION=${3:-0}  # 0 means previous version

echo &quot;ğŸ”„ Starting rollback process...&quot;

# Get current revision
CURRENT_REVISION=$(helm list -n $NAMESPACE -o json | jq -r &quot;.[] | select(.name==\&quot;$RELEASE_NAME\&quot;) | .revision&quot;)
echo &quot;Current revision: $CURRENT_REVISION&quot;

# Calculate target revision
if [ &quot;$ROLLBACK_VERSION&quot; = &quot;0&quot; ]; then
  TARGET_REVISION=$((CURRENT_REVISION - 1))
else
  TARGET_REVISION=$ROLLBACK_VERSION
fi

echo &quot;Target revision: $TARGET_REVISION&quot;

# Perform rollback
helm rollback $RELEASE_NAME $TARGET_REVISION -n $NAMESPACE

# Wait for rollback to complete
kubectl rollout status deployment/$RELEASE_NAME -n $NAMESPACE --timeout=300s

# Verify rollback
echo &quot;ğŸ” Verifying rollback...&quot;
NEW_REVISION=$(helm list -n $NAMESPACE -o json | jq -r &quot;.[] | select(.name==\&quot;$RELEASE_NAME\&quot;) | .revision&quot;)

if [ &quot;$NEW_REVISION&quot; -gt &quot;$CURRENT_REVISION&quot; ]; then
  echo &quot;âœ… Rollback completed successfully. New revision: $NEW_REVISION&quot;
else
  echo &quot;âŒ Rollback failed&quot;
  exit 1
fi

# Run health checks
echo &quot;ğŸ¥ Running health checks...&quot;
kubectl wait --for=condition=available --timeout=300s deployment/$RELEASE_NAME -n $NAMESPACE

# Test application endpoints
if command -v curl &amp;&gt; /dev/null; then
  INGRESS_IP=$(kubectl get ingress -n $NAMESPACE -o jsonpath='{.items[0].status.loadBalancer.ingress[0].ip}')
  if [ ! -z &quot;$INGRESS_IP&quot; ]; then
    curl -f http://$INGRESS_IP/health || {
      echo &quot;âŒ Health check failed after rollback&quot;
      exit 1
    }
    echo &quot;âœ… Health check passed&quot;
  fi
fi

echo &quot;ğŸ‰ Rollback process completed successfully!&quot;
</code></pre>
<h3>æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤</h3>
<pre><code class="language-bash">#!/bin/bash
# scripts/backup-restore.sh

DB_HOST=${DB_HOST:-localhost}
DB_NAME=${DB_NAME:-app_production}
DB_USER=${DB_USER:-app_user}
BACKUP_PATH=${BACKUP_PATH:-/backups}

backup_database() {
  local timestamp=$(date +%Y%m%d_%H%M%S)
  local backup_file=&quot;$BACKUP_PATH/${DB_NAME}_${timestamp}.sql&quot;

  echo &quot;ğŸ“¦ Creating database backup...&quot;
  pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME &gt; $backup_file

  # Compress backup
  gzip $backup_file

  echo &quot;âœ… Backup created: ${backup_file}.gz&quot;

  # Clean old backups (keep last 7 days)
  find $BACKUP_PATH -name &quot;${DB_NAME}_*.sql.gz&quot; -mtime +7 -delete
}

restore_database() {
  local backup_file=$1

  if [ ! -f &quot;$backup_file&quot; ]; then
    echo &quot;âŒ Backup file not found: $backup_file&quot;
    exit 1
  fi

  echo &quot;âš ï¸  WARNING: This will replace the current database!&quot;
  read -p &quot;Are you sure you want to continue? (y/N): &quot; -n 1 -r
  echo

  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo &quot;Operation cancelled&quot;
    exit 0
  fi

  echo &quot;ğŸ”„ Restoring database from backup...&quot;

  # Create a backup of current state first
  backup_database

  # Restore from backup
  if [[ $backup_file == *.gz ]]; then
    gunzip -c $backup_file | psql -h $DB_HOST -U $DB_USER -d $DB_NAME
  else
    psql -h $DB_HOST -U $DB_USER -d $DB_NAME &lt; $backup_file
  fi

  echo &quot;âœ… Database restored successfully&quot;
}

case &quot;$1&quot; in
  backup)
    backup_database
    ;;
  restore)
    restore_database &quot;$2&quot;
    ;;
  *)
    echo &quot;Usage: $0 {backup|restore &lt;backup_file&gt;}&quot;
    exit 1
    ;;
esac
</code></pre>
<h2>æˆæœä¸æ”¶ç›Š</h2>
<h3>é‡åŒ–æŒ‡æ ‡</h3>
<p>é€šè¿‡å®æ–½å®Œæ•´çš„DevOpsæµæ°´çº¿ï¼Œæˆ‘ä»¬è·å¾—äº†æ˜¾è‘—çš„æ”¹å–„ï¼š</p>
<pre><code class="language-javascript">const devopsMetrics = {
  éƒ¨ç½²é¢‘ç‡: {
    ä¹‹å‰: &quot;æ¯æœˆ1-2æ¬¡&quot;,
    ç°åœ¨: &quot;æ¯å¤©3-5æ¬¡&quot;,
    æ”¹å–„: &quot;æå‡15-25å€&quot;
  },

  éƒ¨ç½²æ—¶é—´: {
    ä¹‹å‰: &quot;2-4å°æ—¶&quot;,
    ç°åœ¨: &quot;10-15åˆ†é’Ÿ&quot;,
    æ”¹å–„: &quot;å‡å°‘80-90%&quot;
  },

  æ•…éšœæ¢å¤æ—¶é—´: {
    ä¹‹å‰: &quot;4-8å°æ—¶&quot;,
    ç°åœ¨: &quot;5-15åˆ†é’Ÿ&quot;,
    æ”¹å–„: &quot;å‡å°‘95%&quot;
  },

  å˜æ›´å¤±è´¥ç‡: {
    ä¹‹å‰: &quot;25-30%&quot;,
    ç°åœ¨: &quot;2-5%&quot;,
    æ”¹å–„: &quot;é™ä½85%&quot;
  },

  å›¢é˜Ÿæ•ˆç‡: {
    å¼€å‘æ—¶é—´å æ¯”: &quot;ä»60%æå‡åˆ°85%&quot;,
    è¿ç»´æ—¶é—´å æ¯”: &quot;ä»40%é™ä½åˆ°15%&quot;,
    æ•…éšœå¤„ç†æ—¶é—´: &quot;å‡å°‘70%&quot;
  }
};
</code></pre>
<h3>å›¢é˜Ÿèƒ½åŠ›æå‡</h3>
<pre><code class="language-javascript">const teamImprovements = {
  æŠ€æœ¯èƒ½åŠ›: [
    &quot;å…¨å‘˜æŒæ¡å®¹å™¨åŒ–æŠ€æœ¯&quot;,
    &quot;æ·±å…¥ç†è§£Kubernetes&quot;,
    &quot;ç†Ÿç»ƒä½¿ç”¨ç›‘æ§å·¥å…·&quot;,
    &quot;æŒæ¡åŸºç¡€è®¾æ–½å³ä»£ç &quot;
  ],

  åä½œæ•ˆç‡: [
    &quot;ä»£ç å®¡æŸ¥æ ‡å‡†åŒ–&quot;,
    &quot;éƒ¨ç½²æµç¨‹é€æ˜åŒ–&quot;,
    &quot;é—®é¢˜æ’æŸ¥ç³»ç»ŸåŒ–&quot;,
    &quot;çŸ¥è¯†åˆ†äº«å¸¸æ€åŒ–&quot;
  ],

  è´¨é‡ä¿éšœ: [
    &quot;è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–ç‡95%+&quot;,
    &quot;ä»£ç è´¨é‡é—¨ç¦&quot;,
    &quot;å®‰å…¨æ‰«æé›†æˆ&quot;,
    &quot;æ€§èƒ½ç›‘æ§å®Œå–„&quot;
  ]
};
</code></pre>
<h2>ç»éªŒæ€»ç»“</h2>
<h3>æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>å¾ªåºæ¸è¿›</strong>ï¼šä¸è¦è¯•å›¾ä¸€æ¬¡æ€§å®ç°æ‰€æœ‰åŠŸèƒ½ï¼Œä»ç®€å•çš„CIå¼€å§‹</li>
<li><strong>è‡ªåŠ¨åŒ–ä¼˜å…ˆ</strong>ï¼šä»»ä½•é‡å¤çš„æ“ä½œéƒ½åº”è¯¥è‡ªåŠ¨åŒ–</li>
<li><strong>ç›‘æ§å…ˆè¡Œ</strong>ï¼šåœ¨éƒ¨ç½²æ–°åŠŸèƒ½å‰å…ˆå»ºç«‹ç›‘æ§</li>
<li><strong>å®‰å…¨å·¦ç§»</strong>ï¼šåœ¨å¼€å‘é˜¶æ®µå°±é›†æˆå®‰å…¨æ£€æŸ¥</li>
<li><strong>æ–‡æ¡£å®Œå–„</strong>ï¼šç»´æŠ¤æ¸…æ™°çš„æµç¨‹æ–‡æ¡£å’Œæ•…éšœå¤„ç†æ‰‹å†Œ</li>
</ol>
<h3>å¸¸è§é™·é˜±</h3>
<ol>
<li><strong>è¿‡åº¦å¤æ‚åŒ–</strong>ï¼šä¸è¦ä¸ºäº†è‡ªåŠ¨åŒ–è€Œè‡ªåŠ¨åŒ–</li>
<li><strong>å¿½è§†å®‰å…¨</strong>ï¼šCI/CDæµæ°´çº¿æœ¬èº«ä¹Ÿéœ€è¦å®‰å…¨ä¿æŠ¤</li>
<li><strong>ç¼ºå°‘æµ‹è¯•</strong>ï¼šè‡ªåŠ¨åŒ–è„šæœ¬ä¹Ÿéœ€è¦æµ‹è¯•</li>
<li><strong>ç¯å¢ƒä¸ä¸€è‡´</strong>ï¼šç¡®ä¿æ‰€æœ‰ç¯å¢ƒçš„é…ç½®ä¸€è‡´æ€§</li>
<li><strong>æƒé™ç®¡ç†</strong>ï¼šåˆç†è®¾ç½®è®¿é—®æƒé™ï¼Œé¿å…è¿‡åº¦æˆæƒ</li>
</ol>
<h3>æœªæ¥è§„åˆ’</h3>
<ol>
<li><strong>GitOpså®è·µ</strong>ï¼šä½¿ç”¨ArgoCDç­‰å·¥å…·å®ç°GitOps</li>
<li><strong>æœåŠ¡ç½‘æ ¼</strong>ï¼šå¼•å…¥Istioæå‡å¾®æœåŠ¡æ²»ç†èƒ½åŠ›</li>
<li><strong>æ··æ²Œå·¥ç¨‹</strong>ï¼šå®æ–½æ··æ²Œå·¥ç¨‹æå‡ç³»ç»ŸéŸ§æ€§</li>
<li><strong>AIè¿ç»´</strong>ï¼šåˆ©ç”¨AIæŠ€æœ¯æå‡è¿ç»´æ•ˆç‡</li>
<li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šé€šè¿‡è‡ªåŠ¨åŒ–å®ç°æˆæœ¬çš„ç²¾ç»†åŒ–ç®¡ç†</li>
</ol>
<p>DevOpsæ˜¯ä¸€ä¸ªæŒç»­æ”¹è¿›çš„è¿‡ç¨‹ï¼Œå…³é”®æ˜¯è¦æœ‰åˆé€‚çš„å·¥å…·ã€æµç¨‹å’Œæ–‡åŒ–ã€‚é€šè¿‡ä¸æ–­çš„å®è·µå’Œä¼˜åŒ–ï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿå·²ç»ä»ä¼ ç»Ÿçš„æ‰‹åŠ¨éƒ¨ç½²æ¨¡å¼è½¬å˜ä¸ºç°ä»£åŒ–çš„è‡ªåŠ¨åŒ–è¿ç»´ä½“ç³»ï¼Œè¿™ä¸ä»…æå‡äº†æ•ˆç‡ï¼Œä¹Ÿå¤§å¤§æ”¹å–„äº†ç³»ç»Ÿçš„å¯é æ€§å’Œå›¢é˜Ÿçš„å·¥ä½œä½“éªŒã€‚</p>
                </div>
            </article>
        </div>
    </main>
    
    <footer>
        <p>&copy; 2025 æˆ‘çš„åšå®¢. All rights reserved.</p>
    </footer>
</body>
</html>